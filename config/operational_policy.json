{
  "version": "1.8",
  "policy_name": "Koppsnipern – Operativ Policy (endast botdrift, optimerad)",
  "references": {
    "system_instructions": "Systeminstruktionerna gäller endast GPT-assistentens arbetsmetod och ansvar. Denna policy gäller endast sniper-botens drift.",
    "authority_rule": "Vid konflikt mellan GPT:s arbetsmetod och botens drift: GPT följer Systeminstruktionerna, boten följer denna policy."
  },
  "objectives": {
    "precision_target": "90-95%",
    "precision_formula": "(framgångsrika_trades / totala_trades) * 100",
    "latency_target_ms": 350,
    "max_daily_risk_SOL": 50,
    "core_strategy": [
      "Cupsyy-trigger + regelbaserad filtrering",
      "Säkerhet (rug checks) prioriteras före hastighet",
      "Skalning sker först efter validerad precision"
    ]
  },
  "initialization": {
    "load_policy_at_start": true,
    "confirm_version": true,
    "run_selftest": true,
    "selftest_environment": "Devnet/mock",
    "on_selftest_fail": "Stop trading and log SELFTEST_FAIL"
  },
  "operational_flow": [
    "Upptäck ny pool via Geyser/WebSocket",
    "Bekräfta LaunchLab-initiering (Raydium Initialize) inom 2 sekunder",
    "Kör hårda filter och rug checks",
    "Förbered signerad swap",
    "Vänta på Cupsyy-signal (10–45 sek efter poolskapande, justerbart vid marknadsförändring)",
    "Skicka transaktion som Jito-bundle",
    "Exit enligt exitregler"
  ],
  "filters": {
    "hard_filters": {
      "WSOL_LP_min_SOL": 20,
      "creator_fee_max_percent": 5,
      "mint_authority": "none",
      "freeze_authority": "none",
      "dev_trigger_min_SOL": 1,
      "dev_trigger_time_sec": 10,
      "slippage_estimate_max_percent": 3,
      "RTT_max_ms": 150,
      "max_positions_per_wallet": 2
    }
  },
  "scoring": {
    "formula": "(LP_norm * 0.4) + (dev_trigger * 0.3) + ((rug_score / 100) * 0.2) + (ROI_est * 0.1)",
    "variables": {
      "LP_norm": "clamp((LP - 20) / (150 - 20), 0, 1)",
      "dev_trigger": "Binärt (1 eller 0)"
    }
  },
  "risk_exit": {
    "pause_conditions": [
      "Precision senaste max(50 trades, 24 timmar) < 85%",
      "Dags-P&L < -2% av wallet",
      "RTT > 150 ms i 3 trades i rad",
      "Daglig riskcap nådd (50 SOL)"
    ],
    "exit_rules": {
      "stop_loss": "-4% eller 45 sek timeout",
      "trailing_tp": {
        "activate_at_ROI_percent": 12,
        "lock_profit_percent": 6,
        "stop_loss_follow_percent": 3
      }
    }
  },
  "error_handling": {
    "module_fail": "Logga till Discord och stoppa bot",
    "rpc_or_jito_fail": "Byt till sekundär endpoint",
    "double_endpoint_fail": "Stoppa bot"
  },
  "roadmap_priority": {
    "last_updated": "[datum]",
    "items": [
      "SafetyService (rug checks, metadata, blacklist)",
      "TradePlanner (Cupsyy-trigger, latency, pre-swap)",
      "BundleSender-integration",
      "CI med Devnet-integrationstester",
      "Health-check + metrics",
      "Backtest mot historiska Cupsyy-pooler"
    ]
  },
  "technical_requirements": {
    "performance": "Prestandakritisk kod körs i Node-process",
    "modules": [
      "StreamListener",
      "SafetyService",
      "TradePlanner",
      "TradeService",
      "RiskManager",
      "BundleSender"
    ],
    "latency_budget_ms": {
      "geyser_to_bot": 150,
      "sign_and_send": 50,
      "jito_bundle_execution": 100
    }
  },
  "logging": {
    "log_all_trades_internally": true,
    "log_only_safe_pools_publicly": true,
    "discord_format": "klartext",
    "local_json_schema": {
      "timestamp": "ISO8601",
      "pool_address": "string",
      "rug_score": "number",
      "latency_ms": "number",
      "outcome": "SUCCESS|FAIL|SKIPPED",
      "slot_lag": "number",
      "fee_ratio": "number",
      "roi_percent": "number"
    }
  },
  "document_lifecycle": {
    "type": "versioned_and_iterative",
    "description": "Denna policy är ett levande dokument som används som utvecklingsstöd för sniper-boten. Policyn uppdateras löpande när nya insikter, förbättringar eller ändringar i botens design framkommer under utvecklingsprocessen.",
    "update_protocol": [
      "Alla ändringar ska versioneras med tydlig versionsbeteckning (t.ex. 1.8 → 1.9).",
      "Tidigare versioner arkiveras för full historik och spårbarhet.",
      "Ändringar ska dokumenteras kortfattat i en changelog med datum och ansvarig.",
      "OP används endast som referens vid utveckling och har ingen direkt påverkan på botens realtidsdrift."
    ],
    "review_cycle": "Minst en gång per utvecklingscykel eller vid större arkitekturändring."
  },
  "conflict_handling": [
    "Högsta säkerhetsnivå gäller alltid.",
    "Vid osäkerhet → ingen trade, logga händelsen."
  ]
}
